# Рекомендации по замене Daytona в проекте SUNA

**Дата:** 13 ноября 2025  
**Проект:** SUNA AI Agent Platform  
**Проблема:** Необходимость замены Daytona на собственное или open-source решение для Sandbox

---

## Резюме

После детального исследования альтернатив Daytona для реализации Sandbox в проекте SUNA, **рекомендуется использовать E2B с опцией BYOC (Bring Your Own Cloud)** как оптимальное решение для миграции.

E2B предоставляет баланс между скоростью внедрения, безопасностью данных, и долгосрочной стабильностью, при этом минимизируя изменения в существующем коде.

---

## Сравнение решений

| Критерий | E2B BYOC | Microsandbox | Custom Docker | Daytona (текущее) |
|----------|----------|--------------|---------------|-------------------|
| **Время внедрения** | 8-10 недель | 12-16 недель | 20-24 недели | - |
| **Стоимость** | Enterprise pricing | Бесплатно | Время разработки | Текущие расходы |
| **Безопасность** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **Контроль данных** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| **Поддержка** | Enterprise | Community | Самостоятельно | Vendor |
| **Масштабируемость** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **Изменения кода** | Минимальные | Средние | Значительные | - |
| **Vendor lock-in** | Низкий | Нет | Нет | Высокий |

---

## Рекомендуемое решение: E2B BYOC

### Почему E2B?

E2B является лучшим выбором по следующим причинам:

1. **Проверенное решение** - используется в Manus (похожий AI agent проект), Perplexity, Hugging Face, Groq
2. **BYOC опция** - данные остаются в вашей инфраструктуре (AWS VPC)
3. **Минимальные изменения кода** - похожий API на Daytona, простой адаптер
4. **Enterprise support** - профессиональная поддержка при миграции
5. **Open-source SDK** - прозрачность и возможность кастомизации
6. **Быстрое внедрение** - 8-10 недель vs. 20+ недель для custom решения

### Архитектура E2B BYOC

E2B BYOC развертывается в вашем AWS VPC и состоит из:

- **Orchestrator** - управление sandbox и их жизненным циклом
- **Edge Controller** - маршрутизация трафика и API
- **Monitoring** - сбор метрик (только анонимизированные отправляются в E2B Cloud)
- **Storage** - persistent storage для templates, snapshots, logs

**Безопасность:**
- Все чувствительные данные остаются в вашем VPC
- TLS шифрование для коммуникации
- Опциональный VPC peering для private network
- Только анонимизированные метрики (CPU/memory) отправляются в E2B Cloud

---

## План внедрения

### Фаза 0: Подготовка (1 неделя)
- Исправить текущую проблему с tool calls
- Связаться с E2B enterprise team (enterprise@e2b.dev)
- Получить pricing и technical details
- Подготовить staging окружение

### Фаза 1: Proof of Concept (2 недели)
- Создать E2B account и получить API key
- Разработать адаптер слой для совместимости с текущим API
- Протестировать на E2B Cloud
- Оценить производительность

### Фаза 2: BYOC Deployment (2-3 недели)
- Подготовить AWS account и IAM role
- Развернуть E2B BYOC через Terraform
- Настроить networking и мониторинг
- Интегрировать с SUNA backend

### Фаза 3: Постепенная миграция (3-4 недели)
- Мигрировать инструменты по приоритету (Files → Upload → Browser → Others)
- A/B тестирование (10% → 50% → 100%)
- Мониторинг метрик и исправление проблем

### Фаза 4: Decommission Daytona (1 неделя)
- Отключить Daytona
- Удалить зависимости
- Обновить документацию

**Общее время:** 8-10 недель

---

## Оценка ресурсов

### Команда
- **Backend разработчик:** 1 человек, full-time (8-10 недель)
- **DevOps инженер:** 1 человек, part-time (2-3 недели для Фазы 2)
- **QA инженер:** 1 человек, part-time (все фазы)

### Инфраструктура
- **AWS account** для E2B BYOC
- **Staging сервер** для тестирования
- **Мониторинг** (CloudWatch, Grafana)

### Стоимость
- **E2B BYOC:** Enterprise pricing (нужно уточнять у E2B)
- **AWS инфраструктура:** зависит от использования
- **Время разработки:** ~2-3 месяца одного разработчика

---

## Альтернативные варианты

### Вариант 2: Microsandbox (если бюджет ограничен)

**Плюсы:**
- Полностью бесплатно (open-source)
- Очень быстрый (milliseconds startup)
- Self-hosted, полный контроль

**Минусы:**
- Ранняя стадия разработки
- Меньше функций (нет browser, VNC)
- Потребует больше разработки (12-16 недель)
- Меньше поддержки

**Рекомендуется если:**
- Ограниченный бюджет
- Простые use cases (только code execution)
- Есть время на разработку

### Вариант 3: Custom Docker Solution (долгосрочная стратегия)

**Плюсы:**
- Полный контроль
- Нет vendor lock-in
- Оптимизация под конкретные нужды

**Минусы:**
- Много времени (20-24 недели)
- Нужно поддерживать самостоятельно
- Безопасность - ваша ответственность

**Рекомендуется если:**
- Специфические требования, которые не покрывает E2B
- Долгосрочная перспектива (2+ года)
- Есть команда для разработки и поддержки

---

## Риски и митигация

### Риск 1: E2B BYOC слишком дорогой
**Митигация:** Получить pricing на Фазе 0, подготовить план B с Microsandbox

### Риск 2: Проблемы с производительностью
**Митигация:** Тщательное тестирование в Фазе 1, A/B testing в Фазе 3

### Риск 3: Несовместимость API
**Митигация:** Адаптер слой, постепенная миграция

### Риск 4: Проблемы с AWS deployment
**Митигация:** Помощь от E2B enterprise support, Terraform automation

---

## Следующие шаги

### Немедленно (эта неделя)
1. **Исправить проблему с tool calls**
   - Применить исправления из commit `f399d5a3` на production
   - Перезапустить backend
   - Протестировать работу

2. **Связаться с E2B**
   - Email: enterprise@e2b.dev
   - Запросить:
     - Pricing для BYOC
     - Technical requirements
     - Timeline для deployment
     - Case studies (особенно Manus)

3. **Подготовить staging**
   - Клонировать production database
   - Настроить staging сервер
   - Подготовить тестовые данные

### Следующая неделя
1. **Принять решение**
   - Оценить pricing от E2B
   - Сравнить с альтернативами
   - Принять финальное решение

2. **Начать Фазу 1 (если E2B)**
   - Создать E2B account
   - Начать разработку адаптера
   - Написать unit tests

3. **Или начать PoC с Microsandbox (если не E2B)**
   - Развернуть Microsandbox локально
   - Протестировать базовые функции
   - Оценить feasibility

### Следующий месяц
1. **Завершить PoC**
2. **Начать BYOC deployment (если E2B)**
3. **Подготовить команду к миграции**

---

## Контакты и ресурсы

### E2B
- **Website:** https://e2b.dev
- **Docs:** https://e2b.dev/docs
- **GitHub:** https://github.com/e2b-dev/e2b (9.9K stars)
- **Enterprise:** enterprise@e2b.dev
- **Discord:** https://discord.gg/e2b

### Microsandbox
- **GitHub:** https://github.com/zerocore-ai/microsandbox
- **Docs:** В README репозитория

### Документация проекта
- **Исследование альтернатив:** `/home/ubuntu/sandbox_alternatives_research.md`
- **План миграции:** `/home/ubuntu/migration_plan.md`
- **Анализ Daytona интеграции:** `/home/ubuntu/daytona_integration_analysis.md`

---

## Заключение

Миграция с Daytona на E2B BYOC является оптимальным решением для проекта SUNA, обеспечивающим:

✅ **Безопасность** - данные остаются в вашей инфраструктуре  
✅ **Скорость** - 8-10 недель vs. 20+ недель для custom решения  
✅ **Стабильность** - проверенное решение, используемое в крупных проектах  
✅ **Поддержка** - enterprise support от E2B  
✅ **Гибкость** - open-source SDK, возможность кастомизации  

Начните с исправления текущей проблемы с tool calls, затем свяжитесь с E2B для обсуждения BYOC опции. Параллельно подготовьте staging окружение и начните изучение E2B SDK.

**Рекомендуемый timeline:** Начать немедленно, завершить миграцию через 8-10 недель.
